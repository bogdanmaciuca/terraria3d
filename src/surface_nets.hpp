#pragma once
#include <vector>
#include <glm/glm.hpp>
#include "int.hpp"
#include "heap_array.hpp"
#include "core.hpp"

constexpr glm::vec3 corners[] = {
    { 0, 0, 0 }, // Bottom face, clockwise
    { 1, 0, 0 },
    { 1, 0, 1 },
    { 0, 0, 1 },
    { 0, 1, 0 }, // Top face, clockwise
    { 1, 1, 0 },
    { 1, 1, 1 },
    { 0, 1, 1 },
};

constexpr glm::ivec3 corners_int[] = {
    { 0, 0, 0 }, // Bottom face, clockwise
    { 1, 0, 0 },
    { 1, 0, 1 },
    { 0, 0, 1 },
    { 0, 1, 0 }, // Top face, clockwise
    { 1, 1, 0 },
    { 1, 1, 1 },
    { 0, 1, 1 },
};

constexpr i32 coefficients_sizes[256] = {
    0, 3, 3, 4, 3, 6, 4, 5, 3, 4, 6, 5, 4, 5, 5, 4, 3, 4, 6, 5, 6, 7, 7, 6, 6, 5, 9, 6, 7, 6, 8, 5, 3, 6, 4, 5, 6, 9, 5, 6, 6, 7, 7, 6, 7, 8, 6, 5, 4, 5, 5, 4, 7, 8, 6, 5, 7, 6, 8, 5, 8, 7, 7, 4, 3, 6, 6, 7, 4, 7, 5, 6, 6, 7, 9, 8, 5, 6, 6, 5, 6, 7, 9, 8, 7, 8, 8, 7, 9, 8, 12, 9, 8, 7, 9, 6, 4, 7, 5, 6, 5, 8, 4, 5, 7, 8, 8, 7, 6, 7, 5, 4, 5, 6, 6, 5, 6, 7, 5, 4, 8, 7, 9, 6, 7, 6, 6, 3, 3, 6, 6, 7, 6, 9, 7, 8, 4, 5, 7, 6, 5, 6, 6, 5, 4, 5, 7, 6, 7, 8, 8, 7, 5, 4, 8, 5, 6, 5, 7, 4, 6, 9, 7, 8, 9, 12, 8, 9, 7, 8, 8, 7, 8, 9, 7, 6, 5, 6, 6, 5, 8, 9, 7, 6, 6, 5, 7, 4, 7, 6, 6, 3, 4, 7, 7, 8, 5, 8, 6, 7, 5, 6, 8, 7, 4, 5, 5, 4, 5, 6, 8, 7, 6, 7, 7, 6, 6, 5, 9, 6, 5, 4, 6, 3, 5, 8, 6, 7, 6, 9, 5, 6, 6, 7, 7, 6, 5, 6, 4, 3, 4, 5, 5, 4, 5, 6, 4, 3, 5, 4, 6, 3, 4, 3, 3, 0, 
};

constexpr u8 edges_list[256][12][2] = {
    {  },
    { {0, 1}, {0, 3}, {0, 4},  },
    { {1, 0}, {1, 2}, {1, 5},  },
    { {1, 2}, {0, 3}, {0, 4}, {1, 5},  },
    { {2, 1}, {2, 3}, {2, 6},  },
    { {0, 1}, {2, 1}, {2, 3}, {0, 3}, {0, 4}, {2, 6},  },
    { {1, 0}, {2, 3}, {1, 5}, {2, 6},  },
    { {2, 3}, {0, 3}, {0, 4}, {1, 5}, {2, 6},  },
    { {3, 2}, {3, 0}, {3, 7},  },
    { {0, 1}, {3, 2}, {0, 4}, {3, 7},  },
    { {1, 0}, {1, 2}, {3, 2}, {3, 0}, {1, 5}, {3, 7},  },
    { {1, 2}, {3, 2}, {0, 4}, {1, 5}, {3, 7},  },
    { {2, 1}, {3, 0}, {2, 6}, {3, 7},  },
    { {0, 1}, {2, 1}, {0, 4}, {2, 6}, {3, 7},  },
    { {1, 0}, {3, 0}, {1, 5}, {2, 6}, {3, 7},  },
    { {0, 4}, {1, 5}, {2, 6}, {3, 7},  },
    { {4, 5}, {4, 7}, {4, 0},  },
    { {0, 1}, {0, 3}, {4, 5}, {4, 7},  },
    { {1, 0}, {1, 2}, {4, 5}, {4, 7}, {4, 0}, {1, 5},  },
    { {1, 2}, {0, 3}, {4, 5}, {4, 7}, {1, 5},  },
    { {2, 1}, {2, 3}, {4, 5}, {4, 7}, {4, 0}, {2, 6},  },
    { {0, 1}, {2, 1}, {2, 3}, {0, 3}, {4, 5}, {4, 7}, {2, 6},  },
    { {1, 0}, {2, 3}, {4, 5}, {4, 7}, {4, 0}, {1, 5}, {2, 6},  },
    { {2, 3}, {0, 3}, {4, 5}, {4, 7}, {1, 5}, {2, 6},  },
    { {3, 2}, {3, 0}, {4, 5}, {4, 7}, {4, 0}, {3, 7},  },
    { {0, 1}, {3, 2}, {4, 5}, {4, 7}, {3, 7},  },
    { {1, 0}, {1, 2}, {3, 2}, {3, 0}, {4, 5}, {4, 7}, {4, 0}, {1, 5}, {3, 7},  },
    { {1, 2}, {3, 2}, {4, 5}, {4, 7}, {1, 5}, {3, 7},  },
    { {2, 1}, {3, 0}, {4, 5}, {4, 7}, {4, 0}, {2, 6}, {3, 7},  },
    { {0, 1}, {2, 1}, {4, 5}, {4, 7}, {2, 6}, {3, 7},  },
    { {1, 0}, {3, 0}, {4, 5}, {4, 7}, {4, 0}, {1, 5}, {2, 6}, {3, 7},  },
    { {4, 5}, {4, 7}, {1, 5}, {2, 6}, {3, 7},  },
    { {5, 4}, {5, 6}, {5, 1},  },
    { {0, 1}, {0, 3}, {5, 4}, {5, 6}, {0, 4}, {5, 1},  },
    { {1, 0}, {1, 2}, {5, 4}, {5, 6},  },
    { {1, 2}, {0, 3}, {5, 4}, {5, 6}, {0, 4},  },
    { {2, 1}, {2, 3}, {5, 4}, {5, 6}, {5, 1}, {2, 6},  },
    { {0, 1}, {2, 1}, {2, 3}, {0, 3}, {5, 4}, {5, 6}, {0, 4}, {5, 1}, {2, 6},  },
    { {1, 0}, {2, 3}, {5, 4}, {5, 6}, {2, 6},  },
    { {2, 3}, {0, 3}, {5, 4}, {5, 6}, {0, 4}, {2, 6},  },
    { {3, 2}, {3, 0}, {5, 4}, {5, 6}, {5, 1}, {3, 7},  },
    { {0, 1}, {3, 2}, {5, 4}, {5, 6}, {0, 4}, {5, 1}, {3, 7},  },
    { {1, 0}, {1, 2}, {3, 2}, {3, 0}, {5, 4}, {5, 6}, {3, 7},  },
    { {1, 2}, {3, 2}, {5, 4}, {5, 6}, {0, 4}, {3, 7},  },
    { {2, 1}, {3, 0}, {5, 4}, {5, 6}, {5, 1}, {2, 6}, {3, 7},  },
    { {0, 1}, {2, 1}, {5, 4}, {5, 6}, {0, 4}, {5, 1}, {2, 6}, {3, 7},  },
    { {1, 0}, {3, 0}, {5, 4}, {5, 6}, {2, 6}, {3, 7},  },
    { {5, 4}, {5, 6}, {0, 4}, {2, 6}, {3, 7},  },
    { {5, 6}, {4, 7}, {4, 0}, {5, 1},  },
    { {0, 1}, {0, 3}, {5, 6}, {4, 7}, {5, 1},  },
    { {1, 0}, {1, 2}, {5, 6}, {4, 7}, {4, 0},  },
    { {1, 2}, {0, 3}, {5, 6}, {4, 7},  },
    { {2, 1}, {2, 3}, {5, 6}, {4, 7}, {4, 0}, {5, 1}, {2, 6},  },
    { {0, 1}, {2, 1}, {2, 3}, {0, 3}, {5, 6}, {4, 7}, {5, 1}, {2, 6},  },
    { {1, 0}, {2, 3}, {5, 6}, {4, 7}, {4, 0}, {2, 6},  },
    { {2, 3}, {0, 3}, {5, 6}, {4, 7}, {2, 6},  },
    { {3, 2}, {3, 0}, {5, 6}, {4, 7}, {4, 0}, {5, 1}, {3, 7},  },
    { {0, 1}, {3, 2}, {5, 6}, {4, 7}, {5, 1}, {3, 7},  },
    { {1, 0}, {1, 2}, {3, 2}, {3, 0}, {5, 6}, {4, 7}, {4, 0}, {3, 7},  },
    { {1, 2}, {3, 2}, {5, 6}, {4, 7}, {3, 7},  },
    { {2, 1}, {3, 0}, {5, 6}, {4, 7}, {4, 0}, {5, 1}, {2, 6}, {3, 7},  },
    { {0, 1}, {2, 1}, {5, 6}, {4, 7}, {5, 1}, {2, 6}, {3, 7},  },
    { {1, 0}, {3, 0}, {5, 6}, {4, 7}, {4, 0}, {2, 6}, {3, 7},  },
    { {5, 6}, {4, 7}, {2, 6}, {3, 7},  },
    { {6, 5}, {6, 7}, {6, 2},  },
    { {0, 1}, {0, 3}, {6, 5}, {6, 7}, {0, 4}, {6, 2},  },
    { {1, 0}, {1, 2}, {6, 5}, {6, 7}, {1, 5}, {6, 2},  },
    { {1, 2}, {0, 3}, {6, 5}, {6, 7}, {0, 4}, {1, 5}, {6, 2},  },
    { {2, 1}, {2, 3}, {6, 5}, {6, 7},  },
    { {0, 1}, {2, 1}, {2, 3}, {0, 3}, {6, 5}, {6, 7}, {0, 4},  },
    { {1, 0}, {2, 3}, {6, 5}, {6, 7}, {1, 5},  },
    { {2, 3}, {0, 3}, {6, 5}, {6, 7}, {0, 4}, {1, 5},  },
    { {3, 2}, {3, 0}, {6, 5}, {6, 7}, {6, 2}, {3, 7},  },
    { {0, 1}, {3, 2}, {6, 5}, {6, 7}, {0, 4}, {6, 2}, {3, 7},  },
    { {1, 0}, {1, 2}, {3, 2}, {3, 0}, {6, 5}, {6, 7}, {1, 5}, {6, 2}, {3, 7},  },
    { {1, 2}, {3, 2}, {6, 5}, {6, 7}, {0, 4}, {1, 5}, {6, 2}, {3, 7},  },
    { {2, 1}, {3, 0}, {6, 5}, {6, 7}, {3, 7},  },
    { {0, 1}, {2, 1}, {6, 5}, {6, 7}, {0, 4}, {3, 7},  },
    { {1, 0}, {3, 0}, {6, 5}, {6, 7}, {1, 5}, {3, 7},  },
    { {6, 5}, {6, 7}, {0, 4}, {1, 5}, {3, 7},  },
    { {4, 5}, {6, 5}, {6, 7}, {4, 7}, {4, 0}, {6, 2},  },
    { {0, 1}, {0, 3}, {4, 5}, {6, 5}, {6, 7}, {4, 7}, {6, 2},  },
    { {1, 0}, {1, 2}, {4, 5}, {6, 5}, {6, 7}, {4, 7}, {4, 0}, {1, 5}, {6, 2},  },
    { {1, 2}, {0, 3}, {4, 5}, {6, 5}, {6, 7}, {4, 7}, {1, 5}, {6, 2},  },
    { {2, 1}, {2, 3}, {4, 5}, {6, 5}, {6, 7}, {4, 7}, {4, 0},  },
    { {0, 1}, {2, 1}, {2, 3}, {0, 3}, {4, 5}, {6, 5}, {6, 7}, {4, 7},  },
    { {1, 0}, {2, 3}, {4, 5}, {6, 5}, {6, 7}, {4, 7}, {4, 0}, {1, 5},  },
    { {2, 3}, {0, 3}, {4, 5}, {6, 5}, {6, 7}, {4, 7}, {1, 5},  },
    { {3, 2}, {3, 0}, {4, 5}, {6, 5}, {6, 7}, {4, 7}, {4, 0}, {6, 2}, {3, 7},  },
    { {0, 1}, {3, 2}, {4, 5}, {6, 5}, {6, 7}, {4, 7}, {6, 2}, {3, 7},  },
    { {1, 0}, {1, 2}, {3, 2}, {3, 0}, {4, 5}, {6, 5}, {6, 7}, {4, 7}, {4, 0}, {1, 5}, {6, 2}, {3, 7},  },
    { {1, 2}, {3, 2}, {4, 5}, {6, 5}, {6, 7}, {4, 7}, {1, 5}, {6, 2}, {3, 7},  },
    { {2, 1}, {3, 0}, {4, 5}, {6, 5}, {6, 7}, {4, 7}, {4, 0}, {3, 7},  },
    { {0, 1}, {2, 1}, {4, 5}, {6, 5}, {6, 7}, {4, 7}, {3, 7},  },
    { {1, 0}, {3, 0}, {4, 5}, {6, 5}, {6, 7}, {4, 7}, {4, 0}, {1, 5}, {3, 7},  },
    { {4, 5}, {6, 5}, {6, 7}, {4, 7}, {1, 5}, {3, 7},  },
    { {5, 4}, {6, 7}, {5, 1}, {6, 2},  },
    { {0, 1}, {0, 3}, {5, 4}, {6, 7}, {0, 4}, {5, 1}, {6, 2},  },
    { {1, 0}, {1, 2}, {5, 4}, {6, 7}, {6, 2},  },
    { {1, 2}, {0, 3}, {5, 4}, {6, 7}, {0, 4}, {6, 2},  },
    { {2, 1}, {2, 3}, {5, 4}, {6, 7}, {5, 1},  },
    { {0, 1}, {2, 1}, {2, 3}, {0, 3}, {5, 4}, {6, 7}, {0, 4}, {5, 1},  },
    { {1, 0}, {2, 3}, {5, 4}, {6, 7},  },
    { {2, 3}, {0, 3}, {5, 4}, {6, 7}, {0, 4},  },
    { {3, 2}, {3, 0}, {5, 4}, {6, 7}, {5, 1}, {6, 2}, {3, 7},  },
    { {0, 1}, {3, 2}, {5, 4}, {6, 7}, {0, 4}, {5, 1}, {6, 2}, {3, 7},  },
    { {1, 0}, {1, 2}, {3, 2}, {3, 0}, {5, 4}, {6, 7}, {6, 2}, {3, 7},  },
    { {1, 2}, {3, 2}, {5, 4}, {6, 7}, {0, 4}, {6, 2}, {3, 7},  },
    { {2, 1}, {3, 0}, {5, 4}, {6, 7}, {5, 1}, {3, 7},  },
    { {0, 1}, {2, 1}, {5, 4}, {6, 7}, {0, 4}, {5, 1}, {3, 7},  },
    { {1, 0}, {3, 0}, {5, 4}, {6, 7}, {3, 7},  },
    { {5, 4}, {6, 7}, {0, 4}, {3, 7},  },
    { {6, 7}, {4, 7}, {4, 0}, {5, 1}, {6, 2},  },
    { {0, 1}, {0, 3}, {6, 7}, {4, 7}, {5, 1}, {6, 2},  },
    { {1, 0}, {1, 2}, {6, 7}, {4, 7}, {4, 0}, {6, 2},  },
    { {1, 2}, {0, 3}, {6, 7}, {4, 7}, {6, 2},  },
    { {2, 1}, {2, 3}, {6, 7}, {4, 7}, {4, 0}, {5, 1},  },
    { {0, 1}, {2, 1}, {2, 3}, {0, 3}, {6, 7}, {4, 7}, {5, 1},  },
    { {1, 0}, {2, 3}, {6, 7}, {4, 7}, {4, 0},  },
    { {2, 3}, {0, 3}, {6, 7}, {4, 7},  },
    { {3, 2}, {3, 0}, {6, 7}, {4, 7}, {4, 0}, {5, 1}, {6, 2}, {3, 7},  },
    { {0, 1}, {3, 2}, {6, 7}, {4, 7}, {5, 1}, {6, 2}, {3, 7},  },
    { {1, 0}, {1, 2}, {3, 2}, {3, 0}, {6, 7}, {4, 7}, {4, 0}, {6, 2}, {3, 7},  },
    { {1, 2}, {3, 2}, {6, 7}, {4, 7}, {6, 2}, {3, 7},  },
    { {2, 1}, {3, 0}, {6, 7}, {4, 7}, {4, 0}, {5, 1}, {3, 7},  },
    { {0, 1}, {2, 1}, {6, 7}, {4, 7}, {5, 1}, {3, 7},  },
    { {1, 0}, {3, 0}, {6, 7}, {4, 7}, {4, 0}, {3, 7},  },
    { {6, 7}, {4, 7}, {3, 7},  },
    { {7, 6}, {7, 4}, {7, 3},  },
    { {0, 1}, {0, 3}, {7, 6}, {7, 4}, {0, 4}, {7, 3},  },
    { {1, 0}, {1, 2}, {7, 6}, {7, 4}, {1, 5}, {7, 3},  },
    { {1, 2}, {0, 3}, {7, 6}, {7, 4}, {0, 4}, {1, 5}, {7, 3},  },
    { {2, 1}, {2, 3}, {7, 6}, {7, 4}, {2, 6}, {7, 3},  },
    { {0, 1}, {2, 1}, {2, 3}, {0, 3}, {7, 6}, {7, 4}, {0, 4}, {2, 6}, {7, 3},  },
    { {1, 0}, {2, 3}, {7, 6}, {7, 4}, {1, 5}, {2, 6}, {7, 3},  },
    { {2, 3}, {0, 3}, {7, 6}, {7, 4}, {0, 4}, {1, 5}, {2, 6}, {7, 3},  },
    { {3, 2}, {3, 0}, {7, 6}, {7, 4},  },
    { {0, 1}, {3, 2}, {7, 6}, {7, 4}, {0, 4},  },
    { {1, 0}, {1, 2}, {3, 2}, {3, 0}, {7, 6}, {7, 4}, {1, 5},  },
    { {1, 2}, {3, 2}, {7, 6}, {7, 4}, {0, 4}, {1, 5},  },
    { {2, 1}, {3, 0}, {7, 6}, {7, 4}, {2, 6},  },
    { {0, 1}, {2, 1}, {7, 6}, {7, 4}, {0, 4}, {2, 6},  },
    { {1, 0}, {3, 0}, {7, 6}, {7, 4}, {1, 5}, {2, 6},  },
    { {7, 6}, {7, 4}, {0, 4}, {1, 5}, {2, 6},  },
    { {4, 5}, {7, 6}, {4, 0}, {7, 3},  },
    { {0, 1}, {0, 3}, {4, 5}, {7, 6}, {7, 3},  },
    { {1, 0}, {1, 2}, {4, 5}, {7, 6}, {4, 0}, {1, 5}, {7, 3},  },
    { {1, 2}, {0, 3}, {4, 5}, {7, 6}, {1, 5}, {7, 3},  },
    { {2, 1}, {2, 3}, {4, 5}, {7, 6}, {4, 0}, {2, 6}, {7, 3},  },
    { {0, 1}, {2, 1}, {2, 3}, {0, 3}, {4, 5}, {7, 6}, {2, 6}, {7, 3},  },
    { {1, 0}, {2, 3}, {4, 5}, {7, 6}, {4, 0}, {1, 5}, {2, 6}, {7, 3},  },
    { {2, 3}, {0, 3}, {4, 5}, {7, 6}, {1, 5}, {2, 6}, {7, 3},  },
    { {3, 2}, {3, 0}, {4, 5}, {7, 6}, {4, 0},  },
    { {0, 1}, {3, 2}, {4, 5}, {7, 6},  },
    { {1, 0}, {1, 2}, {3, 2}, {3, 0}, {4, 5}, {7, 6}, {4, 0}, {1, 5},  },
    { {1, 2}, {3, 2}, {4, 5}, {7, 6}, {1, 5},  },
    { {2, 1}, {3, 0}, {4, 5}, {7, 6}, {4, 0}, {2, 6},  },
    { {0, 1}, {2, 1}, {4, 5}, {7, 6}, {2, 6},  },
    { {1, 0}, {3, 0}, {4, 5}, {7, 6}, {4, 0}, {1, 5}, {2, 6},  },
    { {4, 5}, {7, 6}, {1, 5}, {2, 6},  },
    { {5, 4}, {5, 6}, {7, 6}, {7, 4}, {5, 1}, {7, 3},  },
    { {0, 1}, {0, 3}, {5, 4}, {5, 6}, {7, 6}, {7, 4}, {0, 4}, {5, 1}, {7, 3},  },
    { {1, 0}, {1, 2}, {5, 4}, {5, 6}, {7, 6}, {7, 4}, {7, 3},  },
    { {1, 2}, {0, 3}, {5, 4}, {5, 6}, {7, 6}, {7, 4}, {0, 4}, {7, 3},  },
    { {2, 1}, {2, 3}, {5, 4}, {5, 6}, {7, 6}, {7, 4}, {5, 1}, {2, 6}, {7, 3},  },
    { {0, 1}, {2, 1}, {2, 3}, {0, 3}, {5, 4}, {5, 6}, {7, 6}, {7, 4}, {0, 4}, {5, 1}, {2, 6}, {7, 3},  },
    { {1, 0}, {2, 3}, {5, 4}, {5, 6}, {7, 6}, {7, 4}, {2, 6}, {7, 3},  },
    { {2, 3}, {0, 3}, {5, 4}, {5, 6}, {7, 6}, {7, 4}, {0, 4}, {2, 6}, {7, 3},  },
    { {3, 2}, {3, 0}, {5, 4}, {5, 6}, {7, 6}, {7, 4}, {5, 1},  },
    { {0, 1}, {3, 2}, {5, 4}, {5, 6}, {7, 6}, {7, 4}, {0, 4}, {5, 1},  },
    { {1, 0}, {1, 2}, {3, 2}, {3, 0}, {5, 4}, {5, 6}, {7, 6}, {7, 4},  },
    { {1, 2}, {3, 2}, {5, 4}, {5, 6}, {7, 6}, {7, 4}, {0, 4},  },
    { {2, 1}, {3, 0}, {5, 4}, {5, 6}, {7, 6}, {7, 4}, {5, 1}, {2, 6},  },
    { {0, 1}, {2, 1}, {5, 4}, {5, 6}, {7, 6}, {7, 4}, {0, 4}, {5, 1}, {2, 6},  },
    { {1, 0}, {3, 0}, {5, 4}, {5, 6}, {7, 6}, {7, 4}, {2, 6},  },
    { {5, 4}, {5, 6}, {7, 6}, {7, 4}, {0, 4}, {2, 6},  },
    { {5, 6}, {7, 6}, {4, 0}, {5, 1}, {7, 3},  },
    { {0, 1}, {0, 3}, {5, 6}, {7, 6}, {5, 1}, {7, 3},  },
    { {1, 0}, {1, 2}, {5, 6}, {7, 6}, {4, 0}, {7, 3},  },
    { {1, 2}, {0, 3}, {5, 6}, {7, 6}, {7, 3},  },
    { {2, 1}, {2, 3}, {5, 6}, {7, 6}, {4, 0}, {5, 1}, {2, 6}, {7, 3},  },
    { {0, 1}, {2, 1}, {2, 3}, {0, 3}, {5, 6}, {7, 6}, {5, 1}, {2, 6}, {7, 3},  },
    { {1, 0}, {2, 3}, {5, 6}, {7, 6}, {4, 0}, {2, 6}, {7, 3},  },
    { {2, 3}, {0, 3}, {5, 6}, {7, 6}, {2, 6}, {7, 3},  },
    { {3, 2}, {3, 0}, {5, 6}, {7, 6}, {4, 0}, {5, 1},  },
    { {0, 1}, {3, 2}, {5, 6}, {7, 6}, {5, 1},  },
    { {1, 0}, {1, 2}, {3, 2}, {3, 0}, {5, 6}, {7, 6}, {4, 0},  },
    { {1, 2}, {3, 2}, {5, 6}, {7, 6},  },
    { {2, 1}, {3, 0}, {5, 6}, {7, 6}, {4, 0}, {5, 1}, {2, 6},  },
    { {0, 1}, {2, 1}, {5, 6}, {7, 6}, {5, 1}, {2, 6},  },
    { {1, 0}, {3, 0}, {5, 6}, {7, 6}, {4, 0}, {2, 6},  },
    { {5, 6}, {7, 6}, {2, 6},  },
    { {6, 5}, {7, 4}, {6, 2}, {7, 3},  },
    { {0, 1}, {0, 3}, {6, 5}, {7, 4}, {0, 4}, {6, 2}, {7, 3},  },
    { {1, 0}, {1, 2}, {6, 5}, {7, 4}, {1, 5}, {6, 2}, {7, 3},  },
    { {1, 2}, {0, 3}, {6, 5}, {7, 4}, {0, 4}, {1, 5}, {6, 2}, {7, 3},  },
    { {2, 1}, {2, 3}, {6, 5}, {7, 4}, {7, 3},  },
    { {0, 1}, {2, 1}, {2, 3}, {0, 3}, {6, 5}, {7, 4}, {0, 4}, {7, 3},  },
    { {1, 0}, {2, 3}, {6, 5}, {7, 4}, {1, 5}, {7, 3},  },
    { {2, 3}, {0, 3}, {6, 5}, {7, 4}, {0, 4}, {1, 5}, {7, 3},  },
    { {3, 2}, {3, 0}, {6, 5}, {7, 4}, {6, 2},  },
    { {0, 1}, {3, 2}, {6, 5}, {7, 4}, {0, 4}, {6, 2},  },
    { {1, 0}, {1, 2}, {3, 2}, {3, 0}, {6, 5}, {7, 4}, {1, 5}, {6, 2},  },
    { {1, 2}, {3, 2}, {6, 5}, {7, 4}, {0, 4}, {1, 5}, {6, 2},  },
    { {2, 1}, {3, 0}, {6, 5}, {7, 4},  },
    { {0, 1}, {2, 1}, {6, 5}, {7, 4}, {0, 4},  },
    { {1, 0}, {3, 0}, {6, 5}, {7, 4}, {1, 5},  },
    { {6, 5}, {7, 4}, {0, 4}, {1, 5},  },
    { {4, 5}, {6, 5}, {4, 0}, {6, 2}, {7, 3},  },
    { {0, 1}, {0, 3}, {4, 5}, {6, 5}, {6, 2}, {7, 3},  },
    { {1, 0}, {1, 2}, {4, 5}, {6, 5}, {4, 0}, {1, 5}, {6, 2}, {7, 3},  },
    { {1, 2}, {0, 3}, {4, 5}, {6, 5}, {1, 5}, {6, 2}, {7, 3},  },
    { {2, 1}, {2, 3}, {4, 5}, {6, 5}, {4, 0}, {7, 3},  },
    { {0, 1}, {2, 1}, {2, 3}, {0, 3}, {4, 5}, {6, 5}, {7, 3},  },
    { {1, 0}, {2, 3}, {4, 5}, {6, 5}, {4, 0}, {1, 5}, {7, 3},  },
    { {2, 3}, {0, 3}, {4, 5}, {6, 5}, {1, 5}, {7, 3},  },
    { {3, 2}, {3, 0}, {4, 5}, {6, 5}, {4, 0}, {6, 2},  },
    { {0, 1}, {3, 2}, {4, 5}, {6, 5}, {6, 2},  },
    { {1, 0}, {1, 2}, {3, 2}, {3, 0}, {4, 5}, {6, 5}, {4, 0}, {1, 5}, {6, 2},  },
    { {1, 2}, {3, 2}, {4, 5}, {6, 5}, {1, 5}, {6, 2},  },
    { {2, 1}, {3, 0}, {4, 5}, {6, 5}, {4, 0},  },
    { {0, 1}, {2, 1}, {4, 5}, {6, 5},  },
    { {1, 0}, {3, 0}, {4, 5}, {6, 5}, {4, 0}, {1, 5},  },
    { {4, 5}, {6, 5}, {1, 5},  },
    { {5, 4}, {7, 4}, {5, 1}, {6, 2}, {7, 3},  },
    { {0, 1}, {0, 3}, {5, 4}, {7, 4}, {0, 4}, {5, 1}, {6, 2}, {7, 3},  },
    { {1, 0}, {1, 2}, {5, 4}, {7, 4}, {6, 2}, {7, 3},  },
    { {1, 2}, {0, 3}, {5, 4}, {7, 4}, {0, 4}, {6, 2}, {7, 3},  },
    { {2, 1}, {2, 3}, {5, 4}, {7, 4}, {5, 1}, {7, 3},  },
    { {0, 1}, {2, 1}, {2, 3}, {0, 3}, {5, 4}, {7, 4}, {0, 4}, {5, 1}, {7, 3},  },
    { {1, 0}, {2, 3}, {5, 4}, {7, 4}, {7, 3},  },
    { {2, 3}, {0, 3}, {5, 4}, {7, 4}, {0, 4}, {7, 3},  },
    { {3, 2}, {3, 0}, {5, 4}, {7, 4}, {5, 1}, {6, 2},  },
    { {0, 1}, {3, 2}, {5, 4}, {7, 4}, {0, 4}, {5, 1}, {6, 2},  },
    { {1, 0}, {1, 2}, {3, 2}, {3, 0}, {5, 4}, {7, 4}, {6, 2},  },
    { {1, 2}, {3, 2}, {5, 4}, {7, 4}, {0, 4}, {6, 2},  },
    { {2, 1}, {3, 0}, {5, 4}, {7, 4}, {5, 1},  },
    { {0, 1}, {2, 1}, {5, 4}, {7, 4}, {0, 4}, {5, 1},  },
    { {1, 0}, {3, 0}, {5, 4}, {7, 4},  },
    { {5, 4}, {7, 4}, {0, 4},  },
    { {4, 0}, {5, 1}, {6, 2}, {7, 3},  },
    { {0, 1}, {0, 3}, {5, 1}, {6, 2}, {7, 3},  },
    { {1, 0}, {1, 2}, {4, 0}, {6, 2}, {7, 3},  },
    { {1, 2}, {0, 3}, {6, 2}, {7, 3},  },
    { {2, 1}, {2, 3}, {4, 0}, {5, 1}, {7, 3},  },
    { {0, 1}, {2, 1}, {2, 3}, {0, 3}, {5, 1}, {7, 3},  },
    { {1, 0}, {2, 3}, {4, 0}, {7, 3},  },
    { {2, 3}, {0, 3}, {7, 3},  },
    { {3, 2}, {3, 0}, {4, 0}, {5, 1}, {6, 2},  },
    { {0, 1}, {3, 2}, {5, 1}, {6, 2},  },
    { {1, 0}, {1, 2}, {3, 2}, {3, 0}, {4, 0}, {6, 2},  },
    { {1, 2}, {3, 2}, {6, 2},  },
    { {2, 1}, {3, 0}, {4, 0}, {5, 1},  },
    { {0, 1}, {2, 1}, {5, 1},  },
    { {1, 0}, {3, 0}, {4, 0},  },
    {  },
};

constexpr i8 surface = 0;

// TODO: typedef the indices type
struct SurfaceNets {
public:
    void CreateMesh(const HeapArray<core::Voxel, core::ChunkVoxelCount>& voxels);
    const std::vector<core::VoxelVertex>& GetVertices() { return _vertices; }
    const std::vector<core::VoxelIndex>& GetIndices() { return _indices; }

    static SurfaceNets& GetInstance() {
        static SurfaceNets surface_nets;
        return surface_nets;
    }
    SurfaceNets(SurfaceNets const&) = delete;
    void operator=(SurfaceNets const&) = delete;
private:
    struct ActiveCell {
        u8 x, y, z;
    };
    HeapArray<core::VoxelIndex, core::ChunkVoxelCount> _cell_indices;
    std::vector<core::VoxelVertex> _vertices;
    std::vector<core::VoxelIndex> _indices;
    std::vector<ActiveCell> _active_cells;
    void PushFace(core::VoxelIndex i0, core::VoxelIndex i1, core::VoxelIndex i2, core::VoxelIndex i3, bool reverse);

    SurfaceNets() {}
};

